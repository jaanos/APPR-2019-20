---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Lenart Zavrtanik"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding="UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, echo=FALSE, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Analiza plač v Evropi

Analiziral  bom višino povprečne neto plače v Evropi. V svoji nalogi bom višino plače primerjal z različnimi spremenljivkami. Poskušal bom ugotoviti morebitne povezave med njimi.

## Podatkovni viri

* Povprečne plače v Evropi: https://www.reinisfischer.com/average-salary-european-union-2018
* Plače v Sloveniji: https://pxweb.stat.si/SiStatDb/pxweb/sl/10_Dem_soc/10_Dem_soc__07_trg_dela__10_place__01_07010_place/0701011S.px/
* BDP na prebivalca v Evropi: https://ec.europa.eu/eurostat/databrowser/view/sdg_08_10/default/table?lang=en
* Povprečna starost v evropskih državah: https://en.wikipedia.org/wiki/List_of_countries_by_median_age
* Leto osamosvojitve v posameznih državah: https://en.wikipedia.org/wiki/List_of_national_independence_days
* Velikost držav: https://en.wikipedia.org/wiki/List_of_countries_and_dependencies_by_area
* Stopnja kriminala: https://www.numbeo.com/crime/rankings_by_country.jsp?title=2018&region=150
* Življenski stroški: https://www.numbeo.com/cost-of-living/rankings_by_country.jsp?title=2018&region=150

## Zasnova podatkovnega modela

Iz zgornjih spletnih strani bom pobral tabele in jih nato združil v eno tabel. Zbral bom podatke o povprečni plači posameznih držav. V prvem stolpcu tabele bodo naštete države, v drugem neto povprečne plače. V tabelo bom prav tako vključil vse ostale zbrane podatke. Z analizo bom poizkušal ugotoviti kakšne so povezave med analiziranimi spremenljivkami z višino povprečnih plač.

![](slike/grb.png)

## Hipoteze
Postavil sem naslednje hipoteze, ki jih bom v napredni analizi podatkov probal potrditi oziroma ovreči.

Hipoteza 1 : Višji kot je BDP, višja je povprečna plača. 
Hipoteza 2 : Nižja je stopnja kriminala, višja je povprečna plača.
Hipoteza 3 : Višja je povprečna starost, višja je povprečna plača.   
Hipoteza 4 : Države, ki so manj časa samostojne bodo imele nižje povprečne plače.
Hipoteza 5 : Velikost države ne vpliva na višino povprečne plače.
Hipoteza 6:  Države z višjimi povprečnimi plačami bodo imele višje povprečne življenske stroške.
Hipoteza 7:  Nižji kot so davki, višja je povprečna plača.

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Uvozil sem več tabel:

1. `Tabela_place` - podatki o plačah za posamezno evropsko državo
  - `Drzava` - spremenljivka: ime države
  - `letnice;2008-2018` - spremenljivka: višina povprečne plače za posamezno leto v posamezni državi

2. `Tabela_BDP` - podatki o višini BDP per capita
  - `Drzava` - spremenljivka: ime države
  - `letnice;2008-2018` - spremenljivka: višina BDP per capita za posamezno leto v posamezni državi

3. `Tabela_davki` - podatki o davkih
  - `Drzava` - spremenljivka: ime države
  - `letnice;2008-2018` - spremenljivka: višina davkov za posamezno leto v posamezni državi
  
4. `Tabela_starost` - podatki o davkih
  - `Drzava` - spremenljivka: ime države
  - `Povprecna.starost` - spremenljivka: povprečna starost v posamezni državi
  
5. `Tabela_samostojnost` - podatki o davkih
  - `Drzava` - spremenljivka: ime države
  - `Leto.osamosvojitve` - spremenljivka: leto osamosvojitve za posamezno državo
  
6. `Tabela_velikost` - podatki o davkih
  - `Drzava` - spremenljivka: ime države
  - `Povrsina` - spremenljivka: površina posamezne države
  
7. `Tabela_kriminal` - podatki o davkih
  - `Drzava` - spremenljivka: ime države
  - `Stopnja.kriminala` - spremenljivka: stopnja kriminala v posamezni državi
  
8. `Tabela_stroski` - podatki o davkih
  - `Drzava` - spremenljivka: ime države
  - `Zivljenski.stroski` - spremenljivka: življenski stroški v posamezni državi

Za leto 2018 sem vse zgornje tabele združil v eno tabelo, ki sem jo poimenoval Tabela_skupna.

Spodnji graf prikazuje porazdelitev števila naselij v občinah.

```{r histogram, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Histogram števila naselij v občinah'}
ggplot(obcine, aes(x=naselja)) + geom_histogram() +
  ggtitle("Pogostost števila naselij") + xlab("Število naselij") + ylab("Število občin")
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

Spodnji zemljevid prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
ggplot() + geom_polygon(data=left_join(zemljevid, povprecja, by=c("OB_UIME"="obcina")),
                        aes(x=long, y=lat, group=group, fill=povprecje)) +
  ggtitle("Povprečno število otrok v družini") + xlab("") + ylab("") +
  guides(fill=guide_colorbar(title="Povprečje"))
```

***

# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE}
source("analiza/analiza.r", encoding="UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina=names(skupine),
                                     skupina=factor(skupine)), by="obcina")
, aes(x=povrsina, y=naselja, color=skupina, size=prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color=guide_legend(title="Skupina"),
         size=guide_legend(title="Prebivalci (* 1000)"))
```

***

```{r shiny, echo=FALSE}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
